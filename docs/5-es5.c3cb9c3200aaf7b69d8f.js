!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{XURG:function(t,n,a){"use strict";a.r(n),a.d(n,"FaceRecognitionModule",function(){return D});var r,o=a("3Pt+"),c=a("ofXK"),s=a("tyNb"),d=a("mrSG"),l=a("0IaG"),h=a("fXoL"),u=a("bTqV"),b=((r=function(){function t(i,n){e(this,t),this.data=i,this.dialogRef=n,this.message="Are you sure?",this.confirmButtonText="Close",this.cancelButtonText="Cancel",i&&(this.message=i.message||this.message)}return i(t,[{key:"onConfirmClick",value:function(){this.dialogRef.close("passing data here as string or object")}}]),t}()).\u0275fac=function(e){return new(e||r)(h.Mb(l.a),h.Mb(l.f))},r.\u0275cmp=h.Gb({type:r,selectors:[["app-overlay-message"]],decls:6,vars:2,consts:[["align","center"],["mat-raised-button","","color","primary","tabindex","1",3,"click"]],template:function(e,t){1&e&&(h.Sb(0,"mat-dialog-content",0),h.Sb(1,"p"),h.Bc(2),h.Rb(),h.Rb(),h.Sb(3,"mat-dialog-actions",0),h.Sb(4,"button",1),h.Zb("click",function(){return t.onConfirmClick()}),h.Bc(5),h.Rb(),h.Rb()),2&e&&(h.Bb(2),h.Dc(" ",t.message," "),h.Bb(3),h.Cc(t.confirmButtonText))},directives:[l.d,l.c,u.a],encapsulation:2}),r),m=a("qzk7"),p=a("42F4"),g=a("dNgK"),v=a("zkoq"),f=a("Wp6s"),w=a("A5z7"),R=a("Xa2L"),S=["video"],k=["canvasLast"],y=["canvasPrior"];function F(e,t){1&e&&(h.Sb(0,"div",12),h.Sb(1,"div",13),h.Nb(2,"mat-progress-spinner",14),h.Rb(),h.Rb())}var E,C,I=[{path:"",component:(E=function(){function t(i,n,a,r){e(this,t),this.renderer=i,this.os=n,this.dialog=a,this.snackBar=r,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1}return i(t,[{key:"ngOnInit",value:function(){this.breakpoint=window.innerWidth<=400?1:2,this.startCamera(),Promise.all([this.loadF(this.MODEL_URL,"loadFaceDetectionModel"),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel"),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel")]).then(function(e){console.log(e)}).catch(function(e){return console.log(e)}).finally(function(){console.log("done loading"),console.log(m)})}},{key:"onResize",value:function(e){this.breakpoint=e.target.innerWidth<=4?1:2}},{key:"loadF",value:function(e,t){return Object(d.b)(this,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,m[t](e);case 2:case"end":return i.stop()}},i)}))}},{key:"handleError",value:function(e){console.log("Error: ",e)}},{key:"attachVideo",value:function(e){var t=this;this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",function(e){t.videoHeight=t.videoElement.nativeElement.videoHeight,t.videoWidth=t.videoElement.nativeElement.videoWidth})}},{key:"startCamera",value:function(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}},{key:"captureImageFirst",value:function(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"captureImageSecond",value:function(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"capture",value:function(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}},{key:"compareImages",value:function(){return Object(d.b)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.IsWait=!0,e.next=3,this.computeSingleFaceDescriptors(this.canvasLast.nativeElement,this.canvasPrior.nativeElement,"Lyudmil",this.videoHeight,this.videoWidth);case 3:t=e.sent,console.log(t),t<=this.maxDescriptorDistance&&(this.matched="The faces belong to one person!",this.openDialog(this.matched)),this.IsWait=!1;case 5:case"end":return e.stop()}},e,this)}))}},{key:"computeSingleFaceDescriptors",value:function(e,t,i,n,a){return Object(d.b)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var r,o,c,s,d,l,h,u;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r={width:a,height:n},o=this.os.getCache("localStorage","desc","object")[0],c=[],Object.keys(o).forEach(function(e){c.push(o[e])}),i.next=6,m.detectSingleFace(e).withFaceLandmarks().withFaceDescriptor();case 6:return s=i.sent,s=m.resizeResults(s,r),i.next=10,m.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();case 10:return d=i.sent,d=m.resizeResults(d,r),void 0!==s&&(m.draw.drawDetections(e,s),m.draw.drawFaceLandmarks(e,s)),void 0!==d&&(m.draw.drawDetections(t,d),m.draw.drawFaceLandmarks(t,d)),console.log([s.descriptor]),l=[d.descriptor],console.log(l),h=new m.LabeledFaceDescriptors("Prior",l),u=new m.FaceMatcher(h,this.maxDescriptorDistance),i.abrupt("return",[s].map(function(e){return u.findBestMatch(e.descriptor)})[0]._distance);case 16:case"end":return i.stop()}},i,this)}))}},{key:"openDialog",value:function(e){this.dialog.open(b,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe(function(e){})}}]),t}(),E.\u0275fac=function(e){return new(e||E)(h.Mb(h.G),h.Mb(p.b),h.Mb(l.b),h.Mb(g.a))},E.\u0275cmp=h.Gb({type:E,selectors:[["ng-component"]],viewQuery:function(e,t){var i;1&e&&(h.wc(S,!0),h.wc(k,!0),h.wc(y,!0)),2&e&&(h.oc(i=h.ac())&&(t.videoElement=i.first),h.oc(i=h.ac())&&(t.canvasLast=i.first),h.oc(i=h.ac())&&(t.canvasPrior=i.first))},decls:42,vars:9,consts:[["class","overlay",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],[3,"colspan","rowspan"],[3,"click"],["selected","true",1,"pointer",3,"click"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],["color","accent","selected","true",1,"pointer",3,"click"],[1,"vid"],["canvasLast",""],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"]],template:function(e,t){1&e&&(h.Ac(0,F,3,0,"div",0),h.Sb(1,"mat-grid-list",1),h.Zb("resize",function(e){return t.onResize(e)},!1,h.rc),h.Sb(2,"mat-grid-tile",2),h.Sb(3,"mat-card",3),h.Zb("click",function(){return t.capture()}),h.Sb(4,"mat-card-header"),h.Sb(5,"mat-card-subtitle"),h.Sb(6,"mat-chip",4),h.Zb("click",function(){return t.compareImages()}),h.Bc(7,"Compare images"),h.Rb(),h.Rb(),h.Rb(),h.Sb(8,"div",5),h.Nb(9,"video",6,7),h.Rb(),h.Sb(11,"mat-card-content"),h.Sb(12,"p"),h.Bc(13," Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below "),h.Rb(),h.Rb(),h.Sb(14,"mat-card-actions"),h.Sb(15,"mat-chip-list"),h.Sb(16,"mat-chip",8),h.Zb("click",function(){return t.captureImageFirst()}),h.Bc(17,"Capture First Image"),h.Rb(),h.Sb(18,"mat-chip",8),h.Zb("click",function(){return t.captureImageSecond()}),h.Bc(19,"Capture Second Image"),h.Rb(),h.Rb(),h.Rb(),h.Rb(),h.Rb(),h.Sb(20,"mat-grid-tile",2),h.Sb(21,"mat-card",3),h.Zb("click",function(){return t.captureImageFirst()}),h.Sb(22,"mat-card-header"),h.Sb(23,"mat-card-subtitle"),h.Bc(24,"First Image"),h.Rb(),h.Rb(),h.Sb(25,"div",5),h.Nb(26,"canvas",9,10),h.Rb(),h.Sb(28,"mat-card-content"),h.Sb(29,"p"),h.Bc(30," First captured image "),h.Rb(),h.Rb(),h.Rb(),h.Rb(),h.Sb(31,"mat-grid-tile",2),h.Sb(32,"mat-card",3),h.Zb("click",function(){return t.captureImageSecond()}),h.Sb(33,"mat-card-header"),h.Sb(34,"mat-card-subtitle"),h.Bc(35,"Second Image"),h.Rb(),h.Rb(),h.Sb(36,"div",5),h.Nb(37,"canvas",9,11),h.Rb(),h.Sb(39,"mat-card-content"),h.Sb(40,"p"),h.Bc(41," Second captured image "),h.Rb(),h.Rb(),h.Rb(),h.Rb(),h.Rb()),2&e&&(h.ic("ngIf",t.IsWait),h.Bb(1),h.ic("cols",t.breakpoint)("gutterSize","10px"),h.Bb(1),h.ic("colspan",1)("rowspan",3),h.Bb(18),h.ic("colspan",1)("rowspan",2),h.Bb(11),h.ic("colspan",1)("rowspan",2))},directives:[c.k,v.a,v.c,f.a,f.d,f.f,w.a,f.c,f.b,w.b,R.a],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}"]}),E)}],M=a("5dmV"),D=((C=function t(){e(this,t)}).\u0275mod=h.Kb({type:C}),C.\u0275inj=h.Jb({factory:function(e){return new(e||C)},providers:[p.b],imports:[[s.e.forChild(I),o.i,o.d,c.c,M.a]]}),C)}}])}();