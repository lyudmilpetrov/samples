(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{XURG:function(e,t,i){"use strict";i.r(t),i.d(t,"FaceRecognitionModule",function(){return F});var a=i("3Pt+"),s=i("ofXK"),n=i("tyNb"),o=i("mrSG"),c=i("0IaG"),r=i("fXoL"),d=i("bTqV");let l=(()=>{class e{constructor(e,t){this.data=e,this.dialogRef=t,this.message="Are you sure?",this.confirmButtonText="Close",this.cancelButtonText="Cancel",e&&(this.message=e.message||this.message)}onConfirmClick(){this.dialogRef.close("passing data here as string or object")}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(c.a),r.Mb(c.f))},e.\u0275cmp=r.Gb({type:e,selectors:[["app-overlay-message"]],decls:6,vars:2,consts:[["align","center"],["mat-raised-button","","color","primary","tabindex","1",3,"click"]],template:function(e,t){1&e&&(r.Sb(0,"mat-dialog-content",0),r.Sb(1,"p"),r.Bc(2),r.Rb(),r.Rb(),r.Sb(3,"mat-dialog-actions",0),r.Sb(4,"button",1),r.Zb("click",function(){return t.onConfirmClick()}),r.Bc(5),r.Rb(),r.Rb()),2&e&&(r.Bb(2),r.Dc(" ",t.message," "),r.Bb(3),r.Cc(t.confirmButtonText))},directives:[c.d,c.c,d.a],encapsulation:2}),e})();var h=i("qzk7"),b=i("42F4"),m=i("dNgK"),g=i("zkoq"),p=i("Wp6s"),u=i("A5z7"),v=i("Xa2L");const f=["video"],w=["canvasLast"],S=["canvasPrior"];function R(e,t){1&e&&(r.Sb(0,"div",12),r.Sb(1,"div",13),r.Nb(2,"mat-progress-spinner",14),r.Rb(),r.Rb())}const k=[{path:"",component:(()=>{class e{constructor(e,t,i,a){this.renderer=e,this.os=t,this.dialog=i,this.snackBar=a,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1}ngOnInit(){this.breakpoint=window.innerWidth<=400?1:2,this.startCamera(),Promise.all([this.loadF(this.MODEL_URL,"loadFaceDetectionModel"),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel"),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel")]).then(e=>{console.log(e)}).catch(e=>console.log(e)).finally(()=>{console.log("done loading"),console.log(h)})}onResize(e){this.breakpoint=e.target.innerWidth<=4?1:2}loadF(e,t){return Object(o.b)(this,void 0,void 0,function*(){yield h[t](e)})}handleError(e){console.log("Error: ",e)}attachVideo(e){this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",e=>{this.videoHeight=this.videoElement.nativeElement.videoHeight,this.videoWidth=this.videoElement.nativeElement.videoWidth})}startCamera(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}captureImageFirst(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}captureImageSecond(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}capture(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}compareImages(){return Object(o.b)(this,void 0,void 0,function*(){this.IsWait=!0;const e=yield this.computeSingleFaceDescriptors(this.canvasLast.nativeElement,this.canvasPrior.nativeElement,"Lyudmil",this.videoHeight,this.videoWidth);console.log(e),e<=this.maxDescriptorDistance&&(this.matched="The faces belong to one person!",this.openDialog(this.matched)),this.IsWait=!1})}computeSingleFaceDescriptors(e,t,i,a,s){return Object(o.b)(this,void 0,void 0,function*(){const i={width:s,height:a};let n=1;const o=this.os.getCache("localStorage","desc","object")[0],c=[];Object.keys(o).forEach(e=>{c.push(o[e])});let r=yield h.detectSingleFace(e).withFaceLandmarks().withFaceDescriptor();r=h.resizeResults(r,i);let d=yield h.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();d=h.resizeResults(d,i),void 0!==r&&(h.draw.drawDetections(e,r),h.draw.drawFaceLandmarks(e,r)),void 0!==d&&(h.draw.drawDetections(t,d),h.draw.drawFaceLandmarks(t,d)),console.log([r.descriptor]);const l=[d.descriptor];console.log(l);const b=new h.LabeledFaceDescriptors("Prior",l),m=new h.FaceMatcher(b,this.maxDescriptorDistance);return n=[r].map(e=>m.findBestMatch(e.descriptor))[0]._distance,n})}openDialog(e){this.dialog.open(l,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe(e=>{})}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(r.G),r.Mb(b.b),r.Mb(c.b),r.Mb(m.a))},e.\u0275cmp=r.Gb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&(r.wc(f,!0),r.wc(w,!0),r.wc(S,!0)),2&e){let e;r.oc(e=r.ac())&&(t.videoElement=e.first),r.oc(e=r.ac())&&(t.canvasLast=e.first),r.oc(e=r.ac())&&(t.canvasPrior=e.first)}},decls:42,vars:9,consts:[["class","overlay",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],[3,"colspan","rowspan"],[3,"click"],["selected","true",1,"pointer",3,"click"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],["color","accent","selected","true",1,"pointer",3,"click"],[1,"vid"],["canvasLast",""],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"]],template:function(e,t){1&e&&(r.Ac(0,R,3,0,"div",0),r.Sb(1,"mat-grid-list",1),r.Zb("resize",function(e){return t.onResize(e)},!1,r.rc),r.Sb(2,"mat-grid-tile",2),r.Sb(3,"mat-card",3),r.Zb("click",function(){return t.capture()}),r.Sb(4,"mat-card-header"),r.Sb(5,"mat-card-subtitle"),r.Sb(6,"mat-chip",4),r.Zb("click",function(){return t.compareImages()}),r.Bc(7,"Compare images"),r.Rb(),r.Rb(),r.Rb(),r.Sb(8,"div",5),r.Nb(9,"video",6,7),r.Rb(),r.Sb(11,"mat-card-content"),r.Sb(12,"p"),r.Bc(13," Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below "),r.Rb(),r.Rb(),r.Sb(14,"mat-card-actions"),r.Sb(15,"mat-chip-list"),r.Sb(16,"mat-chip",8),r.Zb("click",function(){return t.captureImageFirst()}),r.Bc(17,"Capture First Image"),r.Rb(),r.Sb(18,"mat-chip",8),r.Zb("click",function(){return t.captureImageSecond()}),r.Bc(19,"Capture Second Image"),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(20,"mat-grid-tile",2),r.Sb(21,"mat-card",3),r.Zb("click",function(){return t.captureImageFirst()}),r.Sb(22,"mat-card-header"),r.Sb(23,"mat-card-subtitle"),r.Bc(24,"First Image"),r.Rb(),r.Rb(),r.Sb(25,"div",5),r.Nb(26,"canvas",9,10),r.Rb(),r.Sb(28,"mat-card-content"),r.Sb(29,"p"),r.Bc(30," First captured image "),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(31,"mat-grid-tile",2),r.Sb(32,"mat-card",3),r.Zb("click",function(){return t.captureImageSecond()}),r.Sb(33,"mat-card-header"),r.Sb(34,"mat-card-subtitle"),r.Bc(35,"Second Image"),r.Rb(),r.Rb(),r.Sb(36,"div",5),r.Nb(37,"canvas",9,11),r.Rb(),r.Sb(39,"mat-card-content"),r.Sb(40,"p"),r.Bc(41," Second captured image "),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Rb()),2&e&&(r.ic("ngIf",t.IsWait),r.Bb(1),r.ic("cols",t.breakpoint)("gutterSize","10px"),r.Bb(1),r.ic("colspan",1)("rowspan",3),r.Bb(18),r.ic("colspan",1)("rowspan",2),r.Bb(11),r.ic("colspan",1)("rowspan",2))},directives:[s.k,g.a,g.c,p.a,p.d,p.f,u.a,p.c,p.b,u.b,v.a],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}"]}),e})()}];var y=i("5dmV");let F=(()=>{class e{}return e.\u0275mod=r.Kb({type:e}),e.\u0275inj=r.Jb({factory:function(t){return new(t||e)},providers:[b.b],imports:[[n.e.forChild(k),a.i,a.d,s.c,y.a]]}),e})()}}]);